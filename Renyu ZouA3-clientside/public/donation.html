<!DOCTYPE html>
<html lang="en">

<style>
   
   h3 {
    margin-bottom: 20px;
    text-align: center;
}

/* Spacing for paragraphs */
p {
    margin: 15px 0; /* Adjust spacing between paragraphs */
    text-align: center;
}

/* Donation form styling */
#donation-form {
    margin-top: 10px;
    display: flex;
    flex-direction: column; /* Stack form elements vertically */
    align-items: center; /* Center the form content */
}

/* Label and input styling */
#donation-form label {
    margin-bottom: 10px; /* Space below the label */
    font-weight: bold;
}

#donation-form input {
    padding: 10px;
    margin-bottom: 15px; /* Space below the input field */
    border-radius: 5px;
    border: 1px solid #ccc;
    width: 250px;
}

/* Button styling */
#donation-form button {
    padding: 12px 25px;
    border-radius: 5px;
    background-color: #095739;
    color: white;
    border: none;
    cursor: pointer;
    font-size: 16px;
}

#donation-form button:hover {
    background-color: #074f2b;
}

</style>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <title>Donate</title>
</head>

<body>
    <nav>
        <a href="/">Home page</a>
        <a href="/Fundraisers">Search fundraisers page</a>
    </nav>

    <section id="donation-details" style="text-align: center; padding-top: 20px;"></section>

    <script>
        // Get the query parameters in the URL
        const urlParams = new URLSearchParams(window.location.search);
        const fundraiserId = urlParams.get('id');
        const caption = urlParams.get('caption');
        let target = parseInt( urlParams.get('target'),10);
        let current = parseInt(urlParams.get('current'),10);
        const organizer = urlParams.get('organizer');
        const city = urlParams.get('city');
        const NAME = urlParams.get('name');
        console.log(fundraiserId, caption, target, current, organizer, city, NAME);
        // Donation information is displayed on the page
        const donationDetailsContainer = document.getElementById('donation-details');
        donationDetailsContainer.innerHTML = `
            <h3><strong>Donate to:</strong> ${caption}</h3>
            <p><strong>Fundraiser ID:</strong> ${fundraiserId}</p>
            <p><strong>Organizer:</strong> ${organizer}</p>
            <p><strong>Category:</strong> ${name}</p>
            <p><strong>Target Funding:</strong> $${target}</p>
            <p id="current-funding"><strong>Current Funding:</strong> $${current}</p>
            <p><strong>City:</strong> ${city}</p>
            <form id="donation-form">
                <label for="amount">Donation Amount:</label>
                <input style="margtin-top: 10px;" type="number" id="amount" name="amount" min="1" placeholder="Enter amount" required>
                <label for="amount">Please leave your name: </label>
                <input style="margin-top: 10px;" type="text" id="name" name="name" placeholder="Enter your name" required>
                <button id="donate-button" type="submit" style="margin-top: 10px;">Donate</button>
            </form>
        `;
                // Check if the target has been reached and hide the button
        function checkTargetReached() {
            const currentFundingElement = document.getElementById('donation-form');
            if (current >= target) {
                currentFundingElement.style.display = 'none';  // Hide the donation button
                alert('The target funding has been reached. Thank you for your support!');
                window.location.href ='/Leo?id='+fundraiserId;
            }
        }

        // Check whether the goal has been reached when the page loads for the first time
            checkTargetReached();
    document.getElementById('donation-form').addEventListener('submit', function (event) {
    event.preventDefault();
    let amount = parseInt(document.getElementById('amount').value,10);
    let name = document.getElementById('name').value;
    if (amount && amount > 0) {
        console.log(amount+current,target)
        if(amount<5){
             alert(`the minimum of donation is 5 AUD.`);
        }else if((amount+current)>target){
            alert(`it's too many ,the fundraieser only need ${target-current} AUD.`);
        } else{
        // Build a request body with fundraiserId and donation amount
        const data = {
            fundraiserId: fundraiserId,  
            donationAmount: amount ,     
            giver: name
                    };
        // Send a POST request to the back-end
        fetch('http://localhost:3000/api/donate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data) // Convert the data to JSON format
        })
        .then(response => response.json())
        .then(data => {
            if (data.state==1) {
                const currentFundingElement = document.getElementById('current-funding');
                current+=amount;
                currentFundingElement.innerHTML = `<strong>Current Funding:</strong> $${current}`; 
                alert(`Thank you for donating $${amount} to ${caption}!`);
                checkTargetReached();
                window.location.href ='/Leo?id='+fundraiserId;
            } else {
                alert('Donation failed, please try again.');
            }
        })
        .catch(error => {
            console.log('Error:', error);
        });
    }
    } else {
        alert('Please enter a valid donation amount.');
    }
});
    </script>

</body>

</html>
